<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Th√†nh vi√™n | The Blouse</title>

  <link rel="icon" type="image/png" href="https://i.ibb.co/0jqsMq0Z/your-image.png">
  <link rel="apple-touch-icon" href="https://i.ibb.co/0jqsMq0Z/your-image.png">

  <!-- Font (avoid @import delays) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Use shared site styles (header/footer/theme tokens/etc.) -->
  <link rel="stylesheet" href="./styles.css">

  <style>
    /* ===== Team / Members Page (only page-specific styles) ===== */
    .page-hero{ padding: 54px 0 18px; }
    .page-hero h1{
      margin: 0 0 10px;
      font-size: clamp(28px, 4vw, 42px);
      letter-spacing: -0.03em;
    }
    .page-hero p{
      margin: 0;
      color: var(--t-muted);
      font-weight: 600;
      max-width: 70ch;
    }

    .team-controls{
      margin-top: 22px;
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .search-wrap{
      flex: 1 1 260px;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-panel2) 75%, transparent);
    }
    .search-ico{ opacity:.75; }
    #member-search{
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--t-text);
      font-weight: 700;
    }
    .chips{ display:flex; gap: 10px; flex-wrap: wrap; }
    .chip{
      border: 1px solid var(--t-border);
      background: transparent;
      color: var(--t-text);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 800;
      cursor: pointer;
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    .chip:hover{ transform: translateY(-1px); border-color: color-mix(in srgb, var(--accent) 55%, var(--t-border)); }
    .chip.is-active{
      background: linear-gradient(135deg,
        color-mix(in srgb, var(--accent) 22%, transparent),
        color-mix(in srgb, var(--accent2) 20%, transparent)
      );
      border-color: color-mix(in srgb, var(--accent2) 55%, var(--t-border));
    }

    .team-grid{
      margin: 18px 0 70px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
    }
    @media (max-width: 980px){ .team-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width: 560px){ .team-grid{ grid-template-columns: 1fr; } }

    .profile-card{
      position: relative;
      border-radius: 18px;
      border: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-panel2) 85%, transparent);
      overflow: hidden;
      text-decoration: none;
      color: inherit;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      box-shadow: 0 14px 30px rgba(0,0,0,.18);
    }
    body[data-theme="light"] .profile-card{ box-shadow: 0 12px 26px rgba(14,18,24,.12); }

    .profile-card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(800px 220px at 20% 0%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 60%),
        radial-gradient(700px 200px at 90% 10%, color-mix(in srgb, var(--accent2) 18%, transparent), transparent 60%);
      opacity: .9;
      pointer-events:none;
    }
    .profile-card:hover{
      transform: translateY(-6px);
      border-color: color-mix(in srgb, var(--accent2) 55%, var(--t-border));
      box-shadow: 0 22px 46px rgba(0,0,0,.28);
    }
    body[data-theme="light"] .profile-card:hover{ box-shadow: 0 20px 40px rgba(14,18,24,.18); }

    .profile-top{
      position: relative;
      padding: 16px 16px 10px;
      display:flex;
      align-items:center;
      gap: 12px;
    }
    .avatar{
      width: 56px; height: 56px;
      border-radius: 16px;
      object-fit: cover;
      border: 1px solid color-mix(in srgb, var(--t-border) 70%, transparent);
      background: color-mix(in srgb, var(--t-panel) 85%, transparent);
    }
    .profile-name{
      font-weight: 900;
      letter-spacing: -0.02em;
      font-size: 16px;
      margin: 0;
    }
    .profile-role{
      margin: 2px 0 0;
      color: var(--t-muted);
      font-weight: 800;
      font-size: 13px;
    }
    .profile-body{ position: relative; padding: 0 16px 16px; }
    .profile-bio{
      margin: 8px 0 12px;
      color: color-mix(in srgb, var(--t-text) 86%, var(--t-muted));
      font-weight: 650;
      line-height: 1.5;
      min-height: 3.1em;
    }
    .badges{ display:flex; flex-wrap: wrap; gap: 8px; }
    .badge{
      font-size: 12px;
      font-weight: 850;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-panel) 70%, transparent);
    }

    .profile-actions{
      position: relative;
      padding: 0 16px 16px;
      display:flex;
      gap: 10px;
    }
    .icon-btn{
      flex: 1;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--t-border);
      background: transparent;
      color: var(--t-text);
      font-weight: 900;
      cursor: pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .icon-btn:hover{
      transform: translateY(-1px);
      border-color: color-mix(in srgb, var(--accent2) 55%, var(--t-border));
      background: linear-gradient(135deg,
        color-mix(in srgb, var(--accent) 14%, transparent),
        color-mix(in srgb, var(--accent2) 12%, transparent)
      );
    }
    .icon-btn span{ opacity:.9; }

    .empty-state{
      margin: 14px 0 80px;
      padding: 18px;
      border: 1px dashed var(--t-border);
      border-radius: 16px;
      color: var(--t-muted);
      font-weight: 800;
      display:none;
    }
    .loading-state{
      margin: 14px 0 80px;
      padding: 18px;
      border: 1px dashed var(--t-border);
      border-radius: 16px;
      color: var(--t-muted);
      font-weight: 800;
    }

    /* Modal (Full Profile Sheet) */
    .modal-backdrop{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.60);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 20000;
      padding: 18px;
    }
    .modal{
      width: min(940px, 100%);
      border-radius: 26px;
      border: 1px solid color-mix(in srgb, var(--accent) 22%, var(--t-border));
      background:
        radial-gradient(1200px 600px at 10% 0%, color-mix(in srgb, var(--accent2) 18%, transparent), transparent 55%),
        radial-gradient(900px 500px at 80% 30%, color-mix(in srgb, var(--accent) 16%, transparent), transparent 55%),
        color-mix(in srgb, var(--t-bg) 92%, black);
      box-shadow: 0 34px 110px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modal-head{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 14px;
      border-bottom: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-bg) 82%, black);
    }
    .modal-title{ font-weight: 950; letter-spacing: -0.03em; }
    .modal-close{
      border: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-bg) 80%, black);
      color: var(--t-text);
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 950;
      cursor: pointer;
    }
    .modal-close:hover{ border-color: color-mix(in srgb, var(--accent2) 55%, var(--t-border)); }
    .modal-body{ padding: 18px; }

    .profile-sheet{
      display:grid;
      grid-template-columns: 300px 1fr;
      gap: 18px;
      align-items: stretch;
    }
    @media (max-width: 860px){ .profile-sheet{ grid-template-columns: 1fr; } }

    .p-left{ display:flex; align-items:center; justify-content:center; padding: 18px 10px; }
    .p-avatar-wrap{
      width: 220px; height: 220px;
      border-radius: 999px;
      position: relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .p-avatar-wrap::before{
      content:"";
      position:absolute; inset: -8px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      opacity: .85;
    }
    .p-avatar-wrap::after{
      content:"";
      position:absolute; inset: -26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, color-mix(in srgb, var(--accent2) 40%, transparent), transparent 60%);
      filter: blur(8px);
      opacity: .9;
      pointer-events:none;
    }
    .p-avatar{
      position: relative;
      width: 206px; height: 206px;
      border-radius: 999px;
      object-fit: cover;
      border: 10px solid color-mix(in srgb, var(--t-panel2) 92%, transparent);
      background: color-mix(in srgb, var(--t-panel2) 85%, transparent);
    }

    .p-right{ padding: 8px 8px 6px; }
    .p-hello{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 6px 10px;
      border-radius: 6px;
      font-weight: 950;
      font-size: 12px;
      letter-spacing: .08em;
      color: #fff;
      background: linear-gradient(135deg, var(--accent2), color-mix(in srgb, var(--accent) 92%, #000));
      width: fit-content;
    }
    .p-name{
      margin: 10px 0 6px;
      font-size: 32px;
      line-height: 1.1;
      letter-spacing: -0.03em;
      font-weight: 950;
    }
    .p-divider{ height: 1px; background: var(--t-border); margin: 14px 0; }

    .p-info{
      display:grid;
      grid-template-columns: 140px 1fr;
      gap: 10px 14px;
      font-weight: 800;
      font-size: 14px;
    }
    @media (max-width: 520px){ .p-info{ grid-template-columns: 110px 1fr; } }
    .p-label{ color: var(--t-muted); }
    .p-value a{
      color: var(--accent2);
      text-decoration:none;
      font-weight: 900;
      word-break: break-word;
    }
    .p-value a:hover{ text-decoration: underline; }

    .p-quote{
      margin-top: 16px;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-panel2) 70%, transparent);
      text-align:center;
      font-weight: 800;
      color: var(--t-text);
    }

    .p-actions{
      margin-top: 16px;
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content:center;
    }
    .p-btn{
      appearance:none;
      border: none;
      cursor:pointer;
      text-decoration:none;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 950;
      display:inline-flex;
      align-items:center;
      gap: 10px;
      box-shadow: 0 16px 34px rgba(0,0,0,.18);
    }
    .p-btn.primary{ color: #fff; background: linear-gradient(135deg, #22c1f5, #2563eb); }
    .p-btn.secondary{ color: #fff; background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 88%, #000), color-mix(in srgb, var(--accent2) 90%, #000)); }
    .p-btn.ghost{
      color: var(--t-text);
      border: 1px solid var(--t-border);
      background: color-mix(in srgb, var(--t-bg) 65%, transparent);
      box-shadow:none;
    }
    .p-btn:hover{ transform: translateY(-1px); }
  </style>
</head>

<body>
  <div id="loading-bar"></div>

  <!-- Header: keep same ids so existing theme JS works -->
  <header class="veo-header">
    <div class="veo-top">
      <div class="veo-inner">
        <a class="veo-logo" href="index.html">
          <span class="veo-mark">‚ù§</span>
          <span class="veo-logo-text">The Blouse</span>
        </a>

        <nav class="veo-nav" aria-label="Primary">
          <a href="index.html">Home</a>
          <a href="memb.html" aria-current="page" style="color: var(--purple2);">Team</a>
        </nav>

        <div class="veo-actions">
          <button type="button" class="veo-theme-btn" id="ms-theme-btn" aria-label="Chuy·ªÉn theme">Theme: Dark</button>
          <a class="veo-cta-btn" href="admin.html" style="text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">
            <span class="veo-cta-ico">‚öô</span>
            Admin
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="content-wrapper" style="position:relative; z-index:1;">
    <section class="page-hero">
      <h1>üë• Th√†nh vi√™n</h1>
      <p>Trang gi·ªõi thi·ªáu team ‚Äî d·ªØ li·ªáu load tr·ª±c ti·∫øp t·ª´ Firebase <code>members</code> (th√™m/s·ª≠a/x√≥a b·∫±ng <code>admin.html</code>).</p>

      <div class="team-controls">
        <div class="search-wrap" role="search">
          <span class="search-ico">‚åï</span>
          <input id="member-search" type="search" placeholder="T√¨m theo t√™n / role / bio‚Ä¶" autocomplete="off" />
        </div>

        <div class="chips" id="team-chips" aria-label="L·ªçc theo role"></div>
      </div>
    </section>

    <section aria-label="Danh s√°ch th√†nh vi√™n">
      <div class="loading-state" id="loading-state">ƒêang t·∫£i th√†nh vi√™n‚Ä¶</div>
      <div class="team-grid" id="team-grid"></div>
      <div class="empty-state" id="empty-state">Kh√¥ng t√¨m th·∫•y th√†nh vi√™n n√†o kh·ªõp b·ªô l·ªçc hi·ªán t·∫°i üò≠</div>
    </section>
  </main>

  <!-- Modal -->
  <div class="modal-backdrop" id="member-modal" role="dialog" aria-modal="true" aria-label="Chi ti·∫øt th√†nh vi√™n">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title" id="modal-title">Th√†nh vi√™n</div>
        <button class="modal-close" id="modal-close" type="button">‚úï</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- Footer (same as index) -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-col footer-brand">
        <div class="footer-logo">To @TheBlouse <span aria-hidden="true">‚ô°</span></div>
        <p class="footer-desc">G√≥c nh·ªè ƒë·ªÉ l∆∞u l·∫°i ho·∫°t ƒë·ªông v√† nh·ªØng l·ªùi ch√∫c g·ª≠i t·ªõi Vi·ªán Huy·∫øt h·ªçc.</p>

        <div class="footer-social" aria-label="M·∫°ng x√£ h·ªôi">
          <a class="social-btn" href="https://www.facebook.com/theblouse.prj" aria-label="Facebook">
            <span class="social-ico">f</span><span class="social-text">FACEBOOK</span>
          </a>
          <a class="social-btn" href="https://www.instagram.com/blouse_thantien" aria-label="Instagram">
            <span class="social-ico">‚óé</span><span class="social-text">INSTAGRAM</span>
          </a>
        </div>

        <ul class="footer-contact">
          <li><span class="fc-ico">‚òé</span><span>037 501 3747</span></li>
          <li><span class="fc-ico">‚åÇ</span><span>H√† N·ªôi</span></li>
          <li><span class="fc-ico">‚úâ</span><a href="mailto:hello@example.com">theblouse.prj@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <div class="footer-title">S·∫£n ph·∫©m</div>
        <a class="footer-link" href="index.html#timeline-section">Timeline</a>
        <a class="footer-link" href="index.html#activities-section">Ho·∫°t ƒë·ªông</a>
        <a class="footer-link" href="index.html#messages-section">L·ªùi ch√∫c</a>
        <a class="footer-link" href="memb.html">Th√†nh vi√™n</a>
      </div>

      <div class="footer-col">
        <div class="footer-title">Ch√≠nh s√°ch</div>
        <a class="footer-link" href="#">H∆∞·ªõng d·∫´n</a>
        <a class="footer-link" href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
        <a class="footer-link" href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
        <a class="footer-link" href="#">Li√™n h·ªá h·ªó tr·ª£</a>
      </div>

      <div class="footer-col footer-newsletter" id="newsletter">
        <div class="footer-title">ƒêƒÉng k√≠ nh·∫≠n tin</div>
        <p class="footer-sub">ƒê·ªÉ l·∫°i th√¥ng tin, t·ª•i m√¨nh s·∫Ω c·∫≠p nh·∫≠t nh·ªØng tin t·ª©c quan tr·ªçng.</p>

        <form class="footer-form" onsubmit="return false;">
          <label class="footer-field">
            <span>H·ªç t√™n</span>
            <input type="text" placeholder="T√™n c·ªßa b·∫°n" autocomplete="name">
          </label>

          <label class="footer-field">
            <span>Email</span>
            <input type="email" placeholder="you@email.com" autocomplete="email">
          </label>

          <button class="footer-submit" type="button">ƒêƒÉng k√Ω</button>
        </form>
      </div>
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom-links">
        <a href="#">GI·ªöI THI·ªÜU D·ª∞ √ÅN</a>
        <span class="dot">|</span>
        <a href="memb.html">TH√ÄNH VI√äN THE BLOUSE</a>
        <span class="dot">|</span>
        <a href="#">CHI TI·∫æT HO·∫†T ƒê·ªòNG</a>
      </div>

      <div class="footer-copy">Copyright ¬© 2023 - 2026 ‚Ä¢ All rights reserved</div>

      <button class="footer-top" type="button" aria-label="L√™n ƒë·∫ßu trang">‚åÉ</button>
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // ===== Firebase init (same as index/admin) =====
    const firebaseConfig = {
      apiKey: "AIzaSyCKysT8eZ3LJqyi7vCjoqQGIpjgTyt7HYg",
      authDomain: "loiyeuthuong-5bfab.firebaseapp.com",
      projectId: "loiyeuthuong-5bfab",
      storageBucket: "loiyeuthuong-5bfab.firebasestorage.app",
      messagingSenderId: "544284022045",
      appId: "1:544284022045:web:22f2eef2ed918d93707df4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ===== Utilities =====
    function escapeHtml(text){
      const div = document.createElement("div");
      div.textContent = (text ?? "");
      return div.innerHTML;
    }

    function avatarFallback(name){
      const n = (name || "Member");
      return "https://ui-avatars.com/api/?background=7C3AED&color=fff&name=" + encodeURIComponent(n);
    }

    // ===== Members state =====
    let MEMBERS = [];            // normalized list
    let q = "";
    let activeRole = "ALL";

    const grid = document.getElementById("team-grid");
    const chips = document.getElementById("team-chips");
    const empty = document.getElementById("empty-state");
    const loading = document.getElementById("loading-state");
    const search = document.getElementById("member-search");

    function normalizeMember(doc){
      const d = doc.data() || {};
      const links = {
        facebook: d.facebook || "",
        instagram: d.instagram || ""
      };

      // tags optional: if admin doesn't set tags, we derive from role split by "/" or ","
      let tags = Array.isArray(d.tags) ? d.tags : [];
      if (!tags.length && typeof d.role === "string" && d.role.trim()){
        tags = d.role.split(/[\/,|]/g).map(s => s.trim()).filter(Boolean).slice(0, 3);
      }

      return {
        id: doc.id,
        name: (d.name || "").trim() || "Ch∆∞a c√≥ t√™n",
        role: (d.role || "").trim() || "Ch∆∞a c·∫≠p nh·∫≠t",
        avatar: (d.avatar || "").trim() || avatarFallback(d.name),
        bio: (d.bio || "").trim() || "Ch∆∞a c√≥ m√¥ t·∫£.",
        active: (d.active !== false),
        order: Number.isFinite(d.order) ? d.order : (parseInt(d.order, 10) || 9999),
        links,
        tags
      };
    }

    // ===== Filter / render =====
    function matches(member){
      if (!member.active) return false;

      const roleOk = (activeRole === "ALL") || (member.role === activeRole);
      if (!roleOk) return false;

      if (!q) return true;

      const hay = (member.name + " " + member.role + " " + member.bio + " " + (member.tags || []).join(" "))
        .toLowerCase();

      return hay.includes(q);
    }

    function el(tag, attrs = {}, children = []){
      const node = document.createElement(tag);
      for (const [k, v] of Object.entries(attrs)){
        if (k === "class") node.className = v;
        else if (k === "html") node.innerHTML = v;
        else if (k.startsWith("on") && typeof v === "function") node.addEventListener(k.slice(2), v);
        else node.setAttribute(k, v);
      }
      children.forEach(c => node.appendChild(c));
      return node;
    }

    function card(member){
      const a = el("a", { class: "profile-card", href: "#", "data-id": member.id });
      a.addEventListener("click", (e) => { e.preventDefault(); openModal(member); });

      const top = el("div", { class: "profile-top" });
      top.appendChild(el("img", { class: "avatar", src: member.avatar, alt: member.name, loading: "lazy" }));
      const meta = el("div");
      meta.appendChild(el("p", { class: "profile-name", html: escapeHtml(member.name) }));
      meta.appendChild(el("p", { class: "profile-role", html: escapeHtml(member.role) }));
      top.appendChild(meta);

      const body = el("div", { class: "profile-body" });
      body.appendChild(el("div", { class: "profile-bio", html: escapeHtml(member.bio) }));

      const badges = el("div", { class: "badges" });
      (member.tags || []).slice(0, 3).forEach(t => badges.appendChild(el("span", { class: "badge", html: escapeHtml(t) })));
      body.appendChild(badges);

      const actions = el("div", { class: "profile-actions" });

      const btn1 = el("button", { class: "icon-btn", type: "button" });
      btn1.innerHTML = "<span>üë§</span> Xem";
      btn1.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); openModal(member); });

      const btn2 = el("button", { class: "icon-btn", type: "button" });
      btn2.innerHTML = "<span>‚Üó</span> Social";
      btn2.addEventListener("click", (e) => {
        e.preventDefault(); e.stopPropagation();
        const link = (member.links && (member.links.instagram || member.links.facebook)) || "";
        if (!link) return openModal(member);
        window.open(link, "_blank", "noopener");
      });

      actions.appendChild(btn1);
      actions.appendChild(btn2);

      a.appendChild(top);
      a.appendChild(body);
      a.appendChild(actions);
      return a;
    }

    function renderGrid(){
      grid.innerHTML = "";
      const list = MEMBERS.filter(matches);
      if (!list.length){
        empty.style.display = "block";
      } else {
        empty.style.display = "none";
        list.forEach(m => grid.appendChild(card(m)));
      }
    }

    function setActiveChip(key){
      activeRole = key;
      [...chips.querySelectorAll(".chip")].forEach(c => c.classList.toggle("is-active", c.dataset.key === key));
      renderGrid();
    }

    function renderChips(){
      chips.innerHTML = "";
      const roles = [...new Set(MEMBERS.filter(m => m.active).map(m => m.role))].sort((a,b)=>a.localeCompare(b,'vi'));
      const allBtn = el("button", { class: "chip is-active", type: "button", "data-key": "ALL" });
      allBtn.textContent = "T·∫•t c·∫£";
      allBtn.addEventListener("click", () => setActiveChip("ALL"));
      chips.appendChild(allBtn);

      roles.forEach(r => {
        const b = el("button", { class: "chip", type: "button", "data-key": r });
        b.textContent = r;
        b.addEventListener("click", () => setActiveChip(r));
        chips.appendChild(b);
      });
    }

    // ===== Modal =====
    function openModal(member){
      const modal = document.getElementById("member-modal");
      const title = document.getElementById("modal-title");
      const body = document.getElementById("modal-body");

      title.textContent = member.name;

      const fb = member.links.facebook ? `<a href="${escapeHtml(member.links.facebook)}" target="_blank" rel="noopener">${escapeHtml(member.links.facebook)}</a>` : "<span style='opacity:.7'>(kh√¥ng c√≥)</span>";
      const ig = member.links.instagram ? `<a href="${escapeHtml(member.links.instagram)}" target="_blank" rel="noopener">${escapeHtml(member.links.instagram)}</a>` : "<span style='opacity:.7'>(kh√¥ng c√≥)</span>";

      body.innerHTML = `
        <div class="profile-sheet">
          <div class="p-left">
            <div class="p-avatar-wrap">
              <img class="p-avatar" src="${escapeHtml(member.avatar)}" alt="${escapeHtml(member.name)}" />
            </div>
          </div>

          <div class="p-right">
            <div class="p-hello">THE BLOUSE</div>
            <div class="p-name">${escapeHtml(member.name)}</div>
            <div style="font-weight:900; color: var(--t-muted);">${escapeHtml(member.role)}</div>

            <div class="p-divider"></div>

            <div class="p-info">
              <div class="p-label">Bio</div>
              <div class="p-value">${escapeHtml(member.bio)}</div>

              <div class="p-label">Facebook</div>
              <div class="p-value">${fb}</div>

              <div class="p-label">Instagram</div>
              <div class="p-value">${ig}</div>

              <div class="p-label">Tags</div>
              <div class="p-value">${(member.tags||[]).map(t => `<span class="badge" style="display:inline-flex;margin:0 6px 6px 0;">${escapeHtml(t)}</span>`).join("") || "<span style='opacity:.7'>(kh√¥ng c√≥)</span>"}</div>
            </div>

            <div class="p-quote">‚ÄúC·∫£m ∆°n b·∫°n ƒë√£ gh√© xem team t·ª•i m√¨nh.‚Äù</div>

            <div class="p-actions">
              ${member.links.instagram ? `<a class="p-btn primary" href="${escapeHtml(member.links.instagram)}" target="_blank" rel="noopener"><span>‚óé</span> Instagram</a>` : ""}
              ${member.links.facebook ? `<a class="p-btn secondary" href="${escapeHtml(member.links.facebook)}" target="_blank" rel="noopener"><span>f</span> Facebook</a>` : ""}
              <button class="p-btn ghost" type="button" onclick="(function(){document.getElementById('modal-close').click();})()">
                <span>‚úï</span> ƒê√≥ng
              </button>
            </div>
          </div>
        </div>
      `;

      modal.style.display = "flex";
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      const modal = document.getElementById("member-modal");
      modal.style.display = "none";
      document.body.style.overflow = "";
    }

    document.getElementById("modal-close").addEventListener("click", closeModal);
    document.getElementById("member-modal").addEventListener("click", (e) => { if (e.target.id === "member-modal") closeModal(); });
    window.addEventListener("keydown", (e) => {
      const modal = document.getElementById("member-modal");
      if (e.key === "Escape" && modal.style.display === "flex") closeModal();
    });

    // ===== Search =====
    search.addEventListener("input", (e) => {
      q = (e.target.value || "").trim().toLowerCase();
      renderGrid();
    });

    // ===== Load from Firestore =====
    function loadMembers(){
      loading.style.display = "block";
      db.collection("members")
        .orderBy("order", "asc")
        .onSnapshot((snapshot) => {
          MEMBERS = snapshot.docs.map(normalizeMember);
          loading.style.display = "none";
          renderChips();
          // keep currently selected chip if still exists; else reset
          const roles = new Set(MEMBERS.map(m => m.role));
          if (activeRole !== "ALL" && !roles.has(activeRole)) activeRole = "ALL";
          setActiveChip(activeRole);
        }, (err) => {
          loading.style.display = "none";
          empty.style.display = "block";
          empty.textContent = "L·ªói t·∫£i d·ªØ li·ªáu members: " + (err && err.message ? err.message : err);
        });
    }

    // ===== Theme + footer behaviors (copied from index to keep consistent) =====
    (function(){
      const THEMES = [
        { key: "light", label: "Light" },
        { key: "dim-dark", label: "Dark" }
      ];
      const STORAGE_KEY = "tb_theme";
      function normalizeTheme(key){
        if (!key) return "dim-dark";
        if (key === "grey" || key === "dark") return "dim-dark";
        if (key !== "light" && key !== "dim-dark") return "dim-dark";
        return key;
      }
      function applyTheme(key){
        const k = normalizeTheme(key);
        document.body.setAttribute("data-theme", k);
        const btn = document.getElementById("ms-theme-btn");
        const t = THEMES.find(x => x.key === k) || THEMES[1];
        if (btn) btn.textContent = "Theme: " + t.label;
      }
      function toggleTheme(){
        const current = normalizeTheme(document.body.getAttribute("data-theme") || "dim-dark");
        const next = (current === "dim-dark") ? "light" : "dim-dark";
        localStorage.setItem(STORAGE_KEY, next);
        applyTheme(next);
      }
      document.addEventListener("DOMContentLoaded", function(){
        const saved = normalizeTheme(localStorage.getItem(STORAGE_KEY));
        applyTheme(saved);
        const btn = document.getElementById("ms-theme-btn");
        if (btn) btn.addEventListener("click", toggleTheme);
      });
    })();

    // Loading bar
    window.addEventListener('load', () => {
      const loadingBar = document.getElementById('loading-bar');
      if (!loadingBar) return;
      setTimeout(() => {
        loadingBar.classList.add('loading-complete');
        setTimeout(() => loadingBar.remove(), 500);
      }, 400);
    });

    // Footer back-to-top
    (function(){
      const btn = document.querySelector('.footer-top');
      if(!btn) return;
      btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    })();

    // Kick off
    loadMembers();
  </script>
</body>
</html>
